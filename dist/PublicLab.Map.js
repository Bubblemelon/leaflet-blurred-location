function addGrid(a){function b(a){return{stroke:!0,color:"#3ac1f0",dashArray:null,lineCap:null,lineJoin:null,weight:2,opacity:1,fill:a,fillColor:null,fillOpacity:.5,clickable:!0}}L.VirtualGrid=L.FeatureGroup.extend({include:L.Mixin.Events,options:{cellSize:64,delayFactor:2.5},initialize:function(a){L.Util.setOptions(this,a),L.FeatureGroup.prototype.initialize.call(this,[],a)},onAdd:function(a){L.FeatureGroup.prototype.onAdd.call(this,a),this._map=a,this._cells=[],this._setupGrid(a.getBounds()),a.on("move",this._moveHandler,this),a.on("zoomend",this._zoomHandler,this),a.on("resize",this._resizeHandler,this)},onRemove:function(a){L.FeatureGroup.prototype.onRemove.call(this,a),a.off("move",this._moveHandler,this),a.off("zoomend",this._zoomHandler,this),a.off("resize",this._resizeHandler,this)},_clearLayer:function(a){this._cells=[]},_moveHandler:function(a){this.clearLayers(),this._renderCells(a.target.getBounds())},_zoomHandler:function(a){this.clearLayers(),this._renderCells(a.target.getBounds())},_renderCells:function(a){var c=this._cellsInBounds(a);this.focused_cell_id=0==c.length?null:c[0].id,gridSquareNWCorner=function(){return{lat:c[0].bounds._northEast.lat,lng:c[0].bounds._southWest.lng}},getLocationFromMap(a.getCenter().lat,a.getCenter().lng),this.fire("newcells",c);for(var d=c.length-1;d>=0;d--){var e=c[d],f=e.id==this.focused_cell_id;(function(a,c){var d=b(f);setTimeout(this.addLayer.bind(this,L.rectangle(a.bounds,d)),this.options.delayFactor*c)}).bind(this)(e,d),this._loadedCells.push(e.id)}},_resizeHandler:function(a){this._setupSize()},_setupSize:function(){this._rows=Math.ceil(this._map.getSize().x/this._cellSize),this._cols=Math.ceil(this._map.getSize().y/this._cellSize)},_setupGrid:function(a){this._origin=this._map.project(a.getNorthWest()),this._cellSize=this.options.cellSize,this._setupSize(),this._loadedCells=[],this.clearLayers(),this._renderCells(a)},_cellPoint:function(a,b){var c=this._origin.x+a*this._cellSize,d=this._origin.y+b*this._cellSize;return new L.Point(c,d)},_cellExtent:function(a,b){var c=this._cellPoint(a,b),d=this._cellPoint(a-1,b-1),e=this._map.unproject(c),f=this._map.unproject(d);return new L.LatLngBounds(f,e)},_cellsInBounds:function(a){for(var b=this._map.project(a.getNorthWest()),c=a.getCenter(),d=this._origin.x-b.x,e=this._origin.y-b.y,f=Math.round(d/this._cellSize),g=Math.round(e/this._cellSize),h=[],i=0;i<=this._rows;i++)for(var j=0;j<=this._cols;j++){var k=i-f,l=j-g,m=this._cellExtent(k,l),n=k+":"+l;h.push({id:n,bounds:m,distance:m.getCenter().distanceTo(c)})}return h.sort(function(a,b){return a.distance-b.distance}),h}}),L.virtualGrid=function(a,b){return new L.VirtualGrid(b)},L.virtualGrid({cellSize:64}).addTo(a)}function geoLocateFromInput(a){var b=document.getElementById(a);new google.maps.places.Autocomplete(b).addListener("place_changed",function(){setTimeout(function(){var a=b.value,c=a.split(" ").join("+");$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?address="+c+"&key=AIzaSyDWgc7p4WWFsO3y0MTe50vF4l4NUPcPuwE",function(a){panMap(a.results[0].geometry.location.lat,a.results[0].geometry.location.lng)})},10)})}function geoLocateFromLatLng(a,b){var a=document.getElementById(a),b=document.getElementById(b);a.addEventListener("change blur input",function(){a.value&&b.value&&panMap(a.value,b.value)}),b.addEventListener("change blur input",function(){a.value&&b.value&&panMap(a.value,b.value)})}function panMap(a,b){map.panTo(new L.LatLng(a,b))}function getLocationFromMap(a,b){$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?latlng="+a+","+b,function(a){if(a.status){var b=a.results[0].formatted_address;$("#location").val(b)}})}function getLocation(a){function b(a){panMap(parseFloat(a.coords.latitude),parseFloat(a.coords.longitude))}var c=document.getElementById("location");1==a.checked&&(navigator.geolocation?navigator.geolocation.getCurrentPosition(b):c.innerHTML="Geolocation is not supported by this browser.")}$(document).ready(function(){if(window.hasOwnProperty("google")){var a=document.getElementById("geo_location"),b=new google.maps.places.Autocomplete(a);b.addListener("place_changed",function(){var a=b.getPlace(),c=$("#infoform").data("user");$.ajax({url:"/profile/location/create/"+c,type:"POST",data:{type:"location",value:{address:a.formatted_address}},success:function(a){if(response=a,response.status){$("#location_map").html("<div class='col-md-8' id='map' style='height: 300px;'></div>");var b=new L.map("map").setView([response.location.lat,response.location.lon],15);if(response.location_privacy){var c=response.location.lat,d=response.location.lon;L.tileLayer("https://a.tiles.mapbox.com/v3/jywarren.map-lmrwb2em/{z}/{x}/{y}.png",{attribution:"<a href='http://openstreetmap.org'>OSM</a> tiles by <a href='http://mapbox.com'>MapBox</a>"}).addTo(b);L.marker([c,d]).addTo(b).bindPopup("<b>"+response.name+"</b>").openPopup()}else{var c=parseFloat(response.location.lat).toFixed(4),d=parseFloat(response.location.lon).toFixed(4),e={radius:20,opacity:.5,duration:200,lng:function(a){return a[1]},lat:function(a){return a[0]},value:function(a){return a.length},valueFloor:0,valueCeil:void 0,colorRange:["#f7fbff","#08306b"],onmouseover:function(a,b,c){},onmouseout:function(a,b,c){},onclick:function(a,b,c){}};L.tileLayer("https://a.tiles.mapbox.com/v3/jywarren.map-lmrwb2em/{z}/{x}/{y}.png",{attribution:"<a href='http://openstreetmap.org'>OSM</a> tiles by <a href='http://mapbox.com'>MapBox</a>"}).addTo(b);var f=L.hexbinLayer(e).addTo(b);f.colorScale().range(["white","grey"]),f.data([[c,d]])}}else $("#geo_location").append('<span class="help-block">'+response.errors+"</span>")}})}),$("#location_privacy").click(function(a){a.preventDefault(),that=this;var b=$(this).is(":checked");$.ajax({url:"/profile/user/privacy",type:"POST",data:{location_privacy:b,id:$("#infoform").data("user")},success:function(a){if(a.status)if($(that).prop("checked",a.model.location_privacy),a.model.location_privacy){if(a.lat&&a.long){$("#location_map").html("<div class='col-md-8' id='map' style='height: 300px;'></div>");var b=new L.map("map").setView([a.lat,a.long],15);L.tileLayer("https://a.tiles.mapbox.com/v3/jywarren.map-lmrwb2em/{z}/{x}/{y}.png",{attribution:"<a href='http://openstreetmap.org'>OSM</a> tiles by <a href='http://mapbox.com'>MapBox</a>"}).addTo(b);var c=L.marker([a.lat,a.long]).addTo(b);c.bindPopup("<b>"+a.model.username+"</b>").openPopup()}}else if(a.lat&&a.long){$("#location_map").html("<div class='col-md-8' id='map' style='height: 300px;'></div>");var d=parseFloat(a.lat).toFixed(4),e=parseFloat(a.long).toFixed(4),b=new L.map("map").setView([d,e],15),f={radius:20,opacity:.5,duration:200,lng:function(a){return a[1]},lat:function(a){return a[0]},value:function(a){return a.length},valueFloor:0,valueCeil:void 0,colorRange:["#f7fbff","#08306b"],onmouseover:function(a,b,c){},onmouseout:function(a,b,c){},onclick:function(a,b,c){}};L.tileLayer("https://a.tiles.mapbox.com/v3/jywarren.map-lmrwb2em/{z}/{x}/{y}.png",{attribution:"<a href='http://openstreetmap.org'>OSM</a> tiles by <a href='http://mapbox.com'>MapBox</a>"}).addTo(b);var g=L.hexbinLayer(f).addTo(b);g.colorScale().range(["white","grey"]),g.data([[d,e]])}}})})}});
